{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/antoniussuharmono/dev/binus/ujian/react-native-ujian/movie-list-ujian/app/screens/MovieList/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport React, { useState, useRef, useEffect, useLayoutEffect } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport { Asset } from 'expo-asset';\nimport { Feather } from '@expo/vector-icons';\nimport { Assets as StackAssets } from '@react-navigation/stack';\nimport Screen from \"../../components/common/Screen\";\nimport Spinner from \"../../components/common/Spinner\";\nimport NotificationCard from \"../../components/cards/NotificationCard\";\nimport FilterModal from \"../../components/modals/FilterModal\";\nimport MovieListRow from \"../../components/cards/rows/MovieListRow\";\nimport MovieRow from \"../../components/cards/rows/MovieRow\";\nimport { TouchableOpacity } from \"../../components/common/TouchableOpacity\";\nimport request from \"../../services/api\";\nimport { getItem } from \"../../utils/asyncStorage\";\nimport { getTodayDate } from \"../../utils/dates\";\nimport { darkBlue } from \"../../utils/colors\";\nimport styles from \"./styles\";\n\nvar MovieList = function MovieList(_ref) {\n  var navigation = _ref.navigation,\n      route = _ref.route;\n\n  var _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isLoadingMore = _useState4[0],\n      setIsLoadingMore = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isRefresh = _useState6[0],\n      setIsRefresh = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isError = _useState8[0],\n      setIsError = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      hasAdultContent = _useState10[0],\n      setHasAdultContent = _useState10[1];\n\n  var _useState11 = useState([]),\n      _useState12 = _slicedToArray(_useState11, 2),\n      results = _useState12[0],\n      setResults = _useState12[1];\n\n  var _useState13 = useState(0),\n      _useState14 = _slicedToArray(_useState13, 2),\n      totalPages = _useState14[0],\n      setTotalPages = _useState14[1];\n\n  var _useState15 = useState(0),\n      _useState16 = _slicedToArray(_useState15, 2),\n      page = _useState16[0],\n      setPage = _useState16[1];\n\n  var _useState17 = useState({\n    type: 'popularity.desc',\n    name: 'Most popular'\n  }),\n      _useState18 = _slicedToArray(_useState17, 2),\n      filter = _useState18[0],\n      setFilter = _useState18[1];\n\n  var _useState19 = useState({\n    numColumns: 1,\n    keyGrid: 1\n  }),\n      _useState20 = _slicedToArray(_useState19, 2),\n      view = _useState20[0],\n      setView = _useState20[1];\n\n  var filterModalRef = useRef(null);\n  var _route$params = route.params;\n  _route$params = _route$params === void 0 ? {} : _route$params;\n  var _route$params$id = _route$params.id,\n      id = _route$params$id === void 0 ? null : _route$params$id,\n      _route$params$name = _route$params.name,\n      name = _route$params$name === void 0 ? null : _route$params$name,\n      _route$params$typeReq = _route$params.typeRequest,\n      typeRequest = _route$params$typeReq === void 0 ? 'discover' : _route$params$typeReq;\n\n  var getQueryRequest = function getQueryRequest() {\n    if (typeRequest === 'discover') {\n      return id ? {\n        with_genres: \"\" + id\n      } : null;\n    }\n\n    if (typeRequest === 'search') {\n      return {\n        query: \"\" + name.trim()\n      };\n    }\n\n    return null;\n  };\n\n  var requestMoviesList = function requestMoviesList(resetPage, filterPage) {\n    var _ref2, type, dateRelease, data;\n\n    return _regeneratorRuntime.async(function requestMoviesList$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            setIsLoading(true);\n            _ref2 = filterPage || filter, type = _ref2.type;\n            dateRelease = getTodayDate();\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(request(typeRequest + \"/movie\", _objectSpread({\n              page: resetPage ? 1 : page + 1,\n              'release_date.lte': dateRelease,\n              sort_by: type,\n              with_release_type: '1|2|3|4|5|6|7',\n              include_adult: hasAdultContent\n            }, getQueryRequest())));\n\n          case 6:\n            data = _context.sent;\n            setIsLoading(false);\n            setIsLoadingMore(false);\n            setIsRefresh(false);\n            setIsError(false);\n            setTotalPages(data.total_pages);\n            setPage(data.page);\n            setResults(resetPage ? data.results : [].concat(_toConsumableArray(results), _toConsumableArray(data.results)));\n            _context.next = 22;\n            break;\n\n          case 16:\n            _context.prev = 16;\n            _context.t0 = _context[\"catch\"](0);\n            setIsLoading(false);\n            setIsLoadingMore(false);\n            setIsRefresh(false);\n            setIsError(true);\n\n          case 22:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 16]], Promise);\n  };\n\n  var handleRefresh = function handleRefresh() {\n    return _regeneratorRuntime.async(function handleRefresh$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(setIsRefresh(true));\n\n          case 2:\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(requestMoviesList(true));\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var handleLoadMore = function handleLoadMore() {\n    return _regeneratorRuntime.async(function handleLoadMore$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(setIsLoadingMore(true));\n\n          case 2:\n            _context3.next = 4;\n            return _regeneratorRuntime.awrap(requestMoviesList());\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var handleGrid = function handleGrid() {\n    var numColumns = view.numColumns,\n        keyGrid = view.keyGrid;\n    setView({\n      numColumns: numColumns === 1 ? 2 : 1,\n      keyGrid: keyGrid + 1\n    });\n  };\n\n  var handleFilterModal = function handleFilterModal() {\n    var _filterModalRef$curre;\n\n    (_filterModalRef$curre = filterModalRef.current) == null ? void 0 : _filterModalRef$curre.open();\n  };\n\n  var handleSwitchMovie = function handleSwitchMovie(newFilter) {\n    var _filterModalRef$curre2;\n\n    return _regeneratorRuntime.async(function handleSwitchMovie$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (!(newFilter.type !== filter.type)) {\n              _context4.next = 7;\n              break;\n            }\n\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(setResults([]));\n\n          case 3:\n            _context4.next = 5;\n            return _regeneratorRuntime.awrap(setFilter({\n              type: newFilter.type,\n              name: newFilter.name\n            }));\n\n          case 5:\n            _context4.next = 7;\n            return _regeneratorRuntime.awrap(requestMoviesList(true, {\n              type: newFilter.type,\n              name: newFilter.name\n            }));\n\n          case 7:\n            (_filterModalRef$curre2 = filterModalRef.current) == null ? void 0 : _filterModalRef$curre2.close();\n\n          case 8:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var renderItem = function renderItem(item, type, isSearch, numColumns, navigate) {\n    return React.createElement(MovieRow, {\n      item: item,\n      type: type,\n      isSearch: isSearch,\n      numColumns: numColumns,\n      navigate: navigate,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 5\n      }\n    });\n  };\n\n  var renderFooter = function renderFooter() {\n    if (isLoadingMore) return React.createElement(Spinner, {\n      size: \"small\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 31\n      }\n    });\n\n    if (totalPages !== page && results.length > 0) {\n      return React.createElement(View, {\n        style: styles.loadingMore,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 9\n        }\n      }, React.createElement(TouchableOpacity, {\n        style: styles.loadingButton,\n        onPress: handleLoadMore,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }\n      }, React.createElement(Text, {\n        style: styles.loadingText,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 13\n        }\n      }, \"Load more\")));\n    }\n\n    if (results.length > 0) return React.createElement(View, {\n      style: styles.loadingMore,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 36\n      }\n    });\n    return null;\n  };\n\n  useLayoutEffect(function () {\n    navigation.setOptions({\n      headerRight: function headerRight() {\n        return React.createElement(TouchableOpacity, {\n          style: styles.buttonFilter,\n          onPress: handleFilterModal,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 9\n          }\n        }, React.createElement(Feather, {\n          name: \"filter\",\n          size: 23,\n          color: darkBlue,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 11\n          }\n        }));\n      }\n    });\n  }, [navigation]);\n  useEffect(function () {\n    (function _callee() {\n      var adultContentStorage;\n      return _regeneratorRuntime.async(function _callee$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              Asset.loadAsync(StackAssets);\n              _context5.next = 4;\n              return _regeneratorRuntime.awrap(getItem('@ConfigKey', 'hasAdultContent'));\n\n            case 4:\n              adultContentStorage = _context5.sent;\n              setHasAdultContent(adultContentStorage);\n              requestMoviesList();\n              _context5.next = 12;\n              break;\n\n            case 9:\n              _context5.prev = 9;\n              _context5.t0 = _context5[\"catch\"](0);\n              requestMoviesList();\n\n            case 12:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, [[0, 9]], Promise);\n    })();\n  }, []);\n  var navigate = navigation.navigate;\n  var numColumns = view.numColumns,\n      keyGrid = view.keyGrid;\n  return React.createElement(Screen, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 5\n    }\n  }, React.createElement(View, {\n    style: styles.container,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 7\n    }\n  }, isLoading && !isRefresh && !isLoadingMore ? React.createElement(Spinner, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 11\n    }\n  }) : isError ? React.createElement(NotificationCard, {\n    icon: \"alert-octagon\",\n    onPress: requestMoviesList,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 11\n    }\n  }) : results.length === 0 ? React.createElement(NotificationCard, {\n    icon: \"thumbs-down\",\n    textError: \"No results available.\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 11\n    }\n  }) : React.createElement(View, {\n    style: styles.containerList,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 11\n    }\n  }, results.length > 0 && React.createElement(View, {\n    style: styles.containerMainText,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: styles.textMain,\n    numberOfLines: 1,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 17\n    }\n  }, typeRequest === 'discover' ? filter.name : name), React.createElement(TouchableOpacity, {\n    style: [styles.buttonGrid, numColumns === 2 && styles.buttonGridActive],\n    onPress: handleGrid,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 17\n    }\n  }, React.createElement(Feather, {\n    name: \"grid\",\n    size: 22,\n    color: darkBlue,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 19\n    }\n  }))), React.createElement(MovieListRow, {\n    data: results,\n    type: \"normal\",\n    isSearch: false,\n    keyGrid: keyGrid,\n    numColumns: numColumns,\n    refreshing: isRefresh,\n    onRefresh: handleRefresh,\n    ListFooterComponent: renderFooter,\n    navigate: navigate,\n    renderItem: renderItem,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }\n  })), React.createElement(FilterModal, {\n    ref: filterModalRef,\n    filter: filter,\n    onVisible: handleFilterModal,\n    onFilter: handleSwitchMovie,\n    style: styles.bottomModal,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default MovieList;","map":{"version":3,"sources":["/Users/antoniussuharmono/dev/binus/ujian/react-native-ujian/movie-list-ujian/app/screens/MovieList/index.js"],"names":["React","useState","useRef","useEffect","useLayoutEffect","Asset","Feather","Assets","StackAssets","Screen","Spinner","NotificationCard","FilterModal","MovieListRow","MovieRow","TouchableOpacity","request","getItem","getTodayDate","darkBlue","styles","MovieList","navigation","route","isLoading","setIsLoading","isLoadingMore","setIsLoadingMore","isRefresh","setIsRefresh","isError","setIsError","hasAdultContent","setHasAdultContent","results","setResults","totalPages","setTotalPages","page","setPage","type","name","filter","setFilter","numColumns","keyGrid","view","setView","filterModalRef","params","id","typeRequest","getQueryRequest","with_genres","query","trim","requestMoviesList","resetPage","filterPage","dateRelease","sort_by","with_release_type","include_adult","data","total_pages","handleRefresh","handleLoadMore","handleGrid","handleFilterModal","current","open","handleSwitchMovie","newFilter","close","renderItem","item","isSearch","navigate","renderFooter","length","loadingMore","loadingButton","loadingText","setOptions","headerRight","buttonFilter","loadAsync","adultContentStorage","container","containerList","containerMainText","textMain","buttonGrid","buttonGridActive","bottomModal"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useLayoutEffect } from 'react';\nimport { View, Text } from 'react-native';\nimport { Asset } from 'expo-asset';\nimport { Feather } from '@expo/vector-icons';\nimport { Assets as StackAssets } from '@react-navigation/stack';\n\nimport Screen from '../../components/common/Screen';\nimport Spinner from '../../components/common/Spinner';\nimport NotificationCard from '../../components/cards/NotificationCard';\nimport FilterModal from '../../components/modals/FilterModal';\nimport MovieListRow from '../../components/cards/rows/MovieListRow';\nimport MovieRow from '../../components/cards/rows/MovieRow';\nimport { TouchableOpacity } from '../../components/common/TouchableOpacity';\n\nimport request from '../../services/api';\n\nimport { getItem } from '../../utils/asyncStorage';\nimport { getTodayDate } from '../../utils/dates';\n\nimport { darkBlue } from '../../utils/colors';\n\nimport styles from './styles';\n\nconst MovieList = ({ navigation, route }) => {\n  const [isLoading, setIsLoading] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [isRefresh, setIsRefresh] = useState(false);\n  const [isError, setIsError] = useState(false);\n  const [hasAdultContent, setHasAdultContent] = useState(false);\n  const [results, setResults] = useState([]);\n  const [totalPages, setTotalPages] = useState(0);\n  const [page, setPage] = useState(0);\n  const [filter, setFilter] = useState({\n    type: 'popularity.desc',\n    name: 'Most popular'\n  });\n  const [view, setView] = useState({ numColumns: 1, keyGrid: 1 });\n  const filterModalRef = useRef(null);\n\n  const {\n    params: { id = null, name = null, typeRequest = 'discover' } = {}\n  } = route;\n\n  const getQueryRequest = () => {\n    if (typeRequest === 'discover') {\n      return id ? { with_genres: `${id}` } : null;\n    }\n\n    if (typeRequest === 'search') {\n      return { query: `${name.trim()}` };\n    }\n\n    return null;\n  };\n\n  const requestMoviesList = async (resetPage, filterPage) => {\n    try {\n      setIsLoading(true);\n\n      const { type } = filterPage || filter;\n      const dateRelease = getTodayDate();\n\n      const data = await request(`${typeRequest}/movie`, {\n        page: resetPage ? 1 : page + 1,\n        'release_date.lte': dateRelease,\n        sort_by: type,\n        with_release_type: '1|2|3|4|5|6|7',\n        include_adult: hasAdultContent,\n        ...getQueryRequest()\n      });\n\n      setIsLoading(false);\n      setIsLoadingMore(false);\n      setIsRefresh(false);\n      setIsError(false);\n      setTotalPages(data.total_pages);\n      setPage(data.page);\n      setResults(resetPage ? data.results : [...results, ...data.results]);\n    } catch (err) {\n      setIsLoading(false);\n      setIsLoadingMore(false);\n      setIsRefresh(false);\n      setIsError(true);\n    }\n  };\n\n  const handleRefresh = async () => {\n    await setIsRefresh(true);\n    await requestMoviesList(true);\n  };\n\n  const handleLoadMore = async () => {\n    await setIsLoadingMore(true);\n    await requestMoviesList();\n  };\n\n  const handleGrid = () => {\n    const { numColumns, keyGrid } = view;\n\n    setView({ numColumns: numColumns === 1 ? 2 : 1, keyGrid: keyGrid + 1 });\n  };\n\n  const handleFilterModal = () => {\n    filterModalRef.current?.open();\n  };\n\n  const handleSwitchMovie = async (newFilter) => {\n    if (newFilter.type !== filter.type) {\n      await setResults([]);\n      await setFilter({ type: newFilter.type, name: newFilter.name });\n      await requestMoviesList(true, {\n        type: newFilter.type,\n        name: newFilter.name\n      });\n    }\n\n    filterModalRef.current?.close();\n  };\n\n  const renderItem = (item, type, isSearch, numColumns, navigate) => (\n    <MovieRow\n      item={item}\n      type={type}\n      isSearch={isSearch}\n      numColumns={numColumns}\n      navigate={navigate}\n    />\n  );\n\n  const renderFooter = () => {\n    if (isLoadingMore) return <Spinner size=\"small\" />;\n\n    if (totalPages !== page && results.length > 0) {\n      return (\n        <View style={styles.loadingMore}>\n          <TouchableOpacity\n            style={styles.loadingButton}\n            onPress={handleLoadMore}\n          >\n            <Text style={styles.loadingText}>Load more</Text>\n          </TouchableOpacity>\n        </View>\n      );\n    }\n\n    if (results.length > 0) return <View style={styles.loadingMore} />;\n\n    return null;\n  };\n\n  useLayoutEffect(() => {\n    navigation.setOptions({\n      headerRight: () => (\n        <TouchableOpacity\n          style={styles.buttonFilter}\n          onPress={handleFilterModal}\n        >\n          <Feather name=\"filter\" size={23} color={darkBlue} />\n        </TouchableOpacity>\n      )\n    });\n  }, [navigation]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        Asset.loadAsync(StackAssets);\n\n        const adultContentStorage = await getItem(\n          '@ConfigKey',\n          'hasAdultContent'\n        );\n\n        setHasAdultContent(adultContentStorage);\n        requestMoviesList();\n      } catch (error) {\n        requestMoviesList();\n      }\n    })();\n  }, []);\n\n  const { navigate } = navigation;\n  const { numColumns, keyGrid } = view;\n\n  return (\n    <Screen>\n      <View style={styles.container}>\n        {isLoading && !isRefresh && !isLoadingMore ? (\n          <Spinner />\n        ) : isError ? (\n          <NotificationCard icon=\"alert-octagon\" onPress={requestMoviesList} />\n        ) : results.length === 0 ? (\n          <NotificationCard\n            icon=\"thumbs-down\"\n            textError=\"No results available.\"\n          />\n        ) : (\n          <View style={styles.containerList}>\n            {results.length > 0 && (\n              <View style={styles.containerMainText}>\n                <Text style={styles.textMain} numberOfLines={1}>\n                  {typeRequest === 'discover' ? filter.name : name}\n                </Text>\n                <TouchableOpacity\n                  style={[\n                    styles.buttonGrid,\n                    numColumns === 2 && styles.buttonGridActive\n                  ]}\n                  onPress={handleGrid}\n                >\n                  <Feather name=\"grid\" size={22} color={darkBlue} />\n                </TouchableOpacity>\n              </View>\n            )}\n            <MovieListRow\n              data={results}\n              type=\"normal\"\n              isSearch={false}\n              keyGrid={keyGrid}\n              numColumns={numColumns}\n              refreshing={isRefresh}\n              onRefresh={handleRefresh}\n              ListFooterComponent={renderFooter}\n              navigate={navigate}\n              renderItem={renderItem}\n            />\n          </View>\n        )}\n        <FilterModal\n          ref={filterModalRef}\n          filter={filter}\n          onVisible={handleFilterModal}\n          onFilter={handleSwitchMovie}\n          style={styles.bottomModal}\n        />\n      </View>\n    </Screen>\n  );\n};\n\nexport default MovieList;\n"]},"metadata":{},"sourceType":"module"}